package pkg

import (
	"fmt"
	"os"
	"regexp"
	"runtime"
)

const Version = "20250130"

var ValidFQDNRegex = regexp.MustCompile(`(?i)^([a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?\.)+[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$`)

var UserAgentString = fmt.Sprintf("Mozilla/5.0 (%s %d-bit) dnstwist/%s", runtime.GOOS, 32<<(^uint(0)>>63), Version)

var ThreadCountDefault = min(32, runtime.NumCPU()+4)

var RequestTimeoutDNS = getEnvFloat("REQUEST_TIMEOUT_DNS", 2.5)
var RequestRetriesDNS = getEnvInt("REQUEST_RETRIES_DNS", 2)
var RequestTimeoutHTTP = getEnvFloat("REQUEST_TIMEOUT_HTTP", 5.0)
var RequestTimeoutSMTP = getEnvFloat("REQUEST_TIMEOUT_SMTP", 5.0)
var WebdriverPageloadTimeout = getEnvFloat("WEBDRIVER_PAGELOAD_TIMEOUT", 12.0)

var GlyphsIDNByTLD = map[string]map[string][]string{
	"ad": {}, "cz": {}, "sk": {}, "uk": {}, "co.uk": {}, "nl": {}, "edu": {}, "us": {},
	"jp": {}, "co.jp": {}, "ad.jp": {}, "ne.jp": {},
	"cn": {}, "com.cn": {}, "tw": {}, "com.tw": {}, "net.tw": {},
	"info": {
		"a": {"á", "ä", "å", "ą"},
		"c": {"ć", "č"},
		"e": {"é", "ė", "ę"},
		"i": {"í", "į"},
		"l": {"ł"},
		"n": {"ñ", "ń"},
		"o": {"ó", "ö", "ø", "ő"},
		"s": {"ś", "š"},
		"u": {"ú", "ü", "ū", "ű", "ų"},
		"z": {"ź", "ż", "ž"},
		"ae": {"æ"},
	},
	"br": {
		"a": {"à", "á", "â", "ã"},
		"c": {"ç"},
		"e": {"é", "ê"},
		"i": {"í"},
		"o": {"ó", "ô", "õ"},
		"u": {"ú", "ü"},
		"y": {"ý", "ÿ"},
	},
	"com.br": {
		"a": {"à", "á", "â", "ã"},
		"c": {"ç"},
		"e": {"é", "ê"},
		"i": {"í"},
		"o": {"ó", "ô", "õ"},
		"u": {"ú", "ü"},
		"y": {"ý", "ÿ"},
	},
	"dk": {
		"a": {"ä", "å"},
		"e": {"é"},
		"o": {"ö", "ø"},
		"u": {"ü"},
		"ae": {"æ"},
	},
	"eu": {
		"a": {"á", "à", "ă", "â", "å", "ä", "ã", "ą", "ā"},
		"c": {"ć", "ĉ", "č", "ċ", "ç"},
		"d": {"ď", "đ"},
		"e": {"é", "è", "ĕ", "ê", "ě", "ë", "ė", "ę", "ē"},
		"g": {"ğ", "ĝ", "ġ", "ģ"},
		"h": {"ĥ", "ħ"},
		"i": {"í", "ì", "ĭ", "î", "ï", "ĩ", "į", "ī"},
		"j": {"ĵ"},
		"k": {"ķ", "ĸ"},
		"l": {"ĺ", "ľ", "ļ", "ł"},
		"n": {"ń", "ň", "ñ", "ņ"},
		"o": {"ó", "ò", "ŏ", "ô", "ö", "ő", "õ", "ø", "ō"},
		"r": {"ŕ", "ř", "ŗ"},
		"s": {"ś", "ŝ", "š", "ş"},
		"t": {"ť", "ţ", "ŧ"},
		"u": {"ú", "ù", "ŭ", "û", "ů", "ü", "ű", "ũ", "ų", "ū"},
		"w": {"ŵ"},
		"y": {"ý", "ŷ", "ÿ"},
		"z": {"ź", "ž", "ż"},
		"ae": {"æ"},
		"oe": {"œ"},
	},
	"de": {
		"a": {"á", "à", "ă", "â", "å", "ä", "ã", "ą", "ā"},
		"c": {"ć", "ĉ", "č", "ċ", "ç"},
		"d": {"ď", "đ"},
		"e": {"é", "è", "ĕ", "ê", "ě", "ë", "ė", "ę", "ē"},
		"g": {"ğ", "ĝ", "ġ", "ģ"},
		"h": {"ĥ", "ħ"},
		"i": {"í", "ì", "ĭ", "î", "ï", "ĩ", "į", "ī"},
		"j": {"ĵ"},
		"k": {"ķ", "ĸ"},
		"l": {"ĺ", "ľ", "ļ", "ł"},
		"n": {"ń", "ň", "ñ", "ņ"},
		"o": {"ó", "ò", "ŏ", "ô", "ö", "ő", "õ", "ø", "ō"},
		"r": {"ŕ", "ř", "ŗ"},
		"s": {"ś", "ŝ", "š", "ş"},
		"t": {"ť", "ţ", "ŧ"},
		"u": {"ú", "ù", "ŭ", "û", "ů", "ü", "ű", "ũ", "ų", "ū"},
		"w": {"ŵ"},
		"y": {"ý", "ŷ", "ÿ"},
		"z": {"ź", "ž", "ż"},
		"ae": {"æ"},
		"oe": {"œ"},
	},
	"pl": {
		"a": {"á", "à", "ă", "â", "å", "ä", "ã", "ą", "ā"},
		"c": {"ć", "ĉ", "č", "ċ", "ç"},
		"d": {"ď", "đ"},
		"e": {"é", "è", "ĕ", "ê", "ě", "ë", "ė", "ę", "ē"},
		"g": {"ğ", "ĝ", "ġ", "ģ"},
		"h": {"ĥ", "ħ"},
		"i": {"í", "ì", "ĭ", "î", "ï", "ĩ", "į", "ī"},
		"j": {"ĵ"},
		"k": {"ķ", "ĸ"},
		"l": {"ĺ", "ľ", "ļ", "ł"},
		"n": {"ń", "ň", "ñ", "ņ"},
		"o": {"ó", "ò", "ŏ", "ô", "ö", "ő", "õ", "ø", "ō"},
		"r": {"ŕ", "ř", "ŗ"},
		"s": {"ś", "ŝ", "š", "ş"},
		"t": {"ť", "ţ", "ŧ"},
		"u": {"ú", "ù", "ŭ", "û", "ů", "ü", "ű", "ũ", "ų", "ū"},
		"w": {"ŵ"},
		"y": {"ý", "ŷ", "ÿ"},
		"z": {"ź", "ž", "ż"},
		"ae": {"æ"},
		"oe": {"œ"},
	},
	"fi": {
		"3": {"ʒ"},
		"a": {"á", "ä", "å", "â"},
		"c": {"č"},
		"d": {"đ"},
		"g": {"ǧ", "ǥ"},
		"k": {"ǩ"},
		"n": {"ŋ"},
		"o": {"õ", "ö"},
		"s": {"š"},
		"t": {"ŧ"},
		"z": {"ž"},
	},
	"no": {
		"a": {"á", "à", "ä", "å"},
		"c": {"č", "ç"},
		"e": {"é", "è", "ê"},
		"i": {"ï"},
		"n": {"ŋ", "ń", "ñ"},
		"o": {"ó", "ò", "ô", "ö", "ø"},
		"s": {"š"},
		"t": {"ŧ"},
		"u": {"ü"},
		"z": {"ž"},
		"ae": {"æ"},
	},
	"be": {
		"a": {"à", "á", "â", "ã", "ä", "å"},
		"c": {"ç"},
		"e": {"è", "é", "ê", "ë"},
		"i": {"ì", "í", "î", "ï"},
		"n": {"ñ"},
		"o": {"ò", "ó", "ô", "õ", "ö"},
		"u": {"ù", "ú", "û", "ü"},
		"y": {"ý", "ÿ"},
		"ae": {"æ"},
		"oe": {"œ"},
	},
	"fr": {
		"a": {"à", "á", "â", "ã", "ä", "å"},
		"c": {"ç"},
		"e": {"è", "é", "ê", "ë"},
		"i": {"ì", "í", "î", "ï"},
		"n": {"ñ"},
		"o": {"ò", "ó", "ô", "õ", "ö"},
		"u": {"ù", "ú", "û", "ü"},
		"y": {"ý", "ÿ"},
		"ae": {"æ"},
		"oe": {"œ"},
	},
	"re": {
		"a": {"à", "á", "â", "ã", "ä", "å"},
		"c": {"ç"},
		"e": {"è", "é", "ê", "ë"},
		"i": {"ì", "í", "î", "ï"},
		"n": {"ñ"},
		"o": {"ò", "ó", "ô", "õ", "ö"},
		"u": {"ù", "ú", "û", "ü"},
		"y": {"ý", "ÿ"},
		"ae": {"æ"},
		"oe": {"œ"},
	},
	"yt": {
		"a": {"à", "á", "â", "ã", "ä", "å"},
		"c": {"ç"},
		"e": {"è", "é", "ê", "ë"},
		"i": {"ì", "í", "î", "ï"},
		"n": {"ñ"},
		"o": {"ò", "ó", "ô", "õ", "ö"},
		"u": {"ù", "ú", "û", "ü"},
		"y": {"ý", "ÿ"},
		"ae": {"æ"},
		"oe": {"œ"},
	},
	"pm": {
		"a": {"à", "á", "â", "ã", "ä", "å"},
		"c": {"ç"},
		"e": {"è", "é", "ê", "ë"},
		"i": {"ì", "í", "î", "ï"},
		"n": {"ñ"},
		"o": {"ò", "ó", "ô", "õ", "ö"},
		"u": {"ù", "ú", "û", "ü"},
		"y": {"ý", "ÿ"},
		"ae": {"æ"},
		"oe": {"œ"},
	},
	"wf": {
		"a": {"à", "á", "â", "ã", "ä", "å"},
		"c": {"ç"},
		"e": {"è", "é", "ê", "ë"},
		"i": {"ì", "í", "î", "ï"},
		"n": {"ñ"},
		"o": {"ò", "ó", "ô", "õ", "ö"},
		"u": {"ù", "ú", "û", "ü"},
		"y": {"ý", "ÿ"},
		"ae": {"æ"},
		"oe": {"œ"},
	},
	"tf": {
		"a": {"à", "á", "â", "ã", "ä", "å"},
		"c": {"ç"},
		"e": {"è", "é", "ê", "ë"},
		"i": {"ì", "í", "î", "ï"},
		"n": {"ñ"},
		"o": {"ò", "ó", "ô", "õ", "ö"},
		"u": {"ù", "ú", "û", "ü"},
		"y": {"ý", "ÿ"},
		"ae": {"æ"},
		"oe": {"œ"},
	},
	"ch": {
		"a": {"à", "á", "â", "ã", "ä", "å"},
		"c": {"ç"},
		"e": {"è", "é", "ê", "ë"},
		"i": {"ì", "í", "î", "ï"},
		"n": {"ñ"},
		"o": {"ò", "ó", "ô", "õ", "ö"},
		"u": {"ù", "ú", "û", "ü"},
		"y": {"ý", "ÿ"},
		"ae": {"æ"},
		"oe": {"œ"},
	},
	"li": {
		"a": {"à", "á", "â", "ã", "ä", "å"},
		"c": {"ç"},
		"e": {"è", "é", "ê", "ë"},
		"i": {"ì", "í", "î", "ï"},
		"n": {"ñ"},
		"o": {"ò", "ó", "ô", "õ", "ö"},
		"u": {"ù", "ú", "û", "ü"},
		"y": {"ý", "ÿ"},
		"ae": {"æ"},
		"oe": {"œ"},
	},
	"ca": {
		"a": {"à", "â"},
		"c": {"ç"},
		"e": {"è", "é", "ê", "ë"},
		"i": {"î", "ï"},
		"o": {"ô"},
		"u": {"ù", "û", "ü"},
		"y": {"ÿ"},
		"ae": {"æ"},
		"oe": {"œ"},
	},
}

var GlyphsUnicode = map[string][]string{
	"2": {"ƻ"},
	"3": {"ʒ"},
	"5": {"ƽ"},
	"a": {"ạ", "ă", "ȧ", "ɑ", "å", "ą", "â", "ǎ", "á", "ə", "ä", "ã", "ā", "à"},
	"b": {"ḃ", "ḅ", "ƅ", "ʙ", "ḇ", "ɓ"},
	"c": {"č", "ᴄ", "ċ", "ç", "ć", "ĉ", "ƈ"},
	"d": {"ď", "ḍ", "ḋ", "ɖ", "ḏ", "ɗ", "ḓ", "ḑ", "đ"},
	"e": {"ê", "ẹ", "ę", "è", "ḛ", "ě", "ɇ", "ė", "ĕ", "é", "ë", "ē", "ȩ"},
	"f": {"ḟ", "ƒ"},
	"g": {"ǧ", "ġ", "ǵ", "ğ", "ɡ", "ǥ", "ĝ", "ģ", "ɢ"},
	"h": {"ȟ", "ḫ", "ḩ", "ḣ", "ɦ", "ḥ", "ḧ", "ħ", "ẖ", "ⱨ", "ĥ"},
	"i": {"ɩ", "ǐ", "í", "ɪ", "ỉ", "ȋ", "ɨ", "ï", "ī", "ĩ", "ị", "î", "ı", "ĭ", "į", "ì"},
	"j": {"ǰ", "ĵ", "ʝ", "ɉ"},
	"k": {"ĸ", "ǩ", "ⱪ", "ḵ", "ķ", "ᴋ", "ḳ"},
	"l": {"ĺ", "ł", "ɫ", "ļ", "ľ"},
	"m": {"ᴍ", "ṁ", "ḿ", "ṃ", "ɱ"},
	"n": {"ņ", "ǹ", "ń", "ň", "ṅ", "ṉ", "ṇ", "ꞑ", "ñ", "ŋ"},
	"o": {"ö", "ó", "ȯ", "ỏ", "ô", "ᴏ", "ō", "ò", "ŏ", "ơ", "ő", "õ", "ọ", "ø"},
	"p": {"ṗ", "ƿ", "ƥ", "ṕ"},
	"q": {"ʠ"},
	"r": {"ʀ", "ȓ", "ɍ", "ɾ", "ř", "ṛ", "ɽ", "ȑ", "ṙ", "ŗ", "ŕ", "ɼ", "ṟ"},
	"s": {"ṡ", "ș", "ŝ", "ꜱ", "ʂ", "š", "ś", "ṣ", "ş"},
	"t": {"ť", "ƫ", "ţ", "ṭ", "ṫ", "ț", "ŧ"},
	"u": {"ᴜ", "ų", "ŭ", "ū", "ű", "ǔ", "ȕ", "ư", "ù", "ů", "ʉ", "ú", "ȗ", "ü", "û", "ũ", "ụ"},
	"v": {"ᶌ", "ṿ", "ᴠ", "ⱴ", "ⱱ", "ṽ"},
	"w": {"ᴡ", "ẇ", "ẅ", "ẃ", "ẘ", "ẉ", "ⱳ", "ŵ", "ẁ"},
	"x": {"ẋ", "ẍ"},
	"y": {"ŷ", "ÿ", "ʏ", "ẏ", "ɏ", "ƴ", "ȳ", "ý", "ỿ", "ỵ"},
	"z": {"ž", "ƶ", "ẓ", "ẕ", "ⱬ", "ᴢ", "ż", "ź", "ʐ"},
	"ae": {"æ"},
	"oe": {"œ"},
}

var GlyphsASCII = map[string][]string{
	"0": {"o"},
	"1": {"l", "i"},
	"3": {"8"},
	"6": {"9"},
	"8": {"3"},
	"9": {"6"},
	"b": {"d", "lb"},
	"c": {"e"},
	"d": {"b", "cl", "dl"},
	"e": {"c"},
	"g": {"q"},
	"h": {"lh"},
	"i": {"1", "l"},
	"k": {"lc"},
	"l": {"1", "i"},
	"m": {"n", "nn", "rn"},
	"n": {"m", "r"},
	"o": {"0"},
	"q": {"g"},
	"u": {"v"},
	"v": {"u"},
	"w": {"vv"},
	"rn": {"m"},
	"cl": {"d"},
}

var LatinToCyrillic = map[string]string{
	"a": "а", "b": "ь", "c": "с", "d": "ԁ", "e": "е", "g": "ԍ", "h": "һ",
	"i": "і", "j": "ј", "k": "к", "l": "ӏ", "m": "м", "o": "о", "p": "р",
	"q": "ԛ", "s": "ѕ", "t": "т", "v": "ѵ", "w": "ԝ", "x": "х", "y": "у",
}

var Qwerty = map[string]string{
	"1": "2q", "2": "3wq1", "3": "4ew2", "4": "5re3", "5": "6tr4", "6": "7yt5", "7": "8uy6", "8": "9iu7", "9": "0oi8", "0": "po9",
	"q": "12wa", "w": "3esaq2", "e": "4rdsw3", "r": "5tfde4", "t": "6ygfr5", "y": "7uhgt6", "u": "8ijhy7", "i": "9okju8", "o": "0plki9", "p": "lo0",
	"a": "qwsz", "s": "edxzaw", "d": "rfcxse", "f": "tgvcdr", "g": "yhbvft", "h": "ujnbgy", "j": "ikmnhu", "k": "olmji", "l": "kop",
	"z": "asx", "x": "zsdc", "c": "xdfv", "v": "cfgb", "b": "vghn", "n": "bhjm", "m": "njk",
}

var Qwertz = map[string]string{
	"1": "2q", "2": "3wq1", "3": "4ew2", "4": "5re3", "5": "6tr4", "6": "7zt5", "7": "8uz6", "8": "9iu7", "9": "0oi8", "0": "po9",
	"q": "12wa", "w": "3esaq2", "e": "4rdsw3", "r": "5tfde4", "t": "6zgfr5", "z": "7uhgt6", "u": "8ijhz7", "i": "9okju8", "o": "0plki9", "p": "lo0",
	"a": "qwsy", "s": "edxyaw", "d": "rfcxse", "f": "tgvcdr", "g": "zhbvft", "h": "ujnbgz", "j": "ikmnhu", "k": "olmji", "l": "kop",
	"y": "asx", "x": "ysdc", "c": "xdfv", "v": "cfgb", "b": "vghn", "n": "bhjm", "m": "njk",
}

var Azerty = map[string]string{
	"1": "2a", "2": "3za1", "3": "4ez2", "4": "5re3", "5": "6tr4", "6": "7yt5", "7": "8uy6", "8": "9iu7", "9": "0oi8", "0": "po9",
	"a": "2zq1", "z": "3esqa2", "e": "4rdsz3", "r": "5tfde4", "t": "6ygfr5", "y": "7uhgt6", "u": "8ijhy7", "i": "9okju8", "o": "0plki9", "p": "lo0m",
	"q": "zswa", "s": "edxwqz", "d": "rfcxse", "f": "tgvcdr", "g": "yhbvft", "h": "ujnbgy", "j": "iknhu", "k": "olji", "l": "kopm", "m": "lp",
	"w": "sxq", "x": "wsdc", "c": "xdfv", "v": "cfgb", "b": "vghn", "n": "bhj",
}

var Keyboards = []map[string]string{Qwerty, Qwertz, Azerty}

func getEnvFloat(key string, defaultVal float64) float64 {
	if val := os.Getenv(key); val != "" {
		var f float64
		if _, err := fmt.Sscanf(val, "%f", &f); err == nil {
			return f
		}
	}
	return defaultVal
}

func getEnvInt(key string, defaultVal int) int {
	if val := os.Getenv(key); val != "" {
		var i int
		if _, err := fmt.Sscanf(val, "%d", &i); err == nil {
			return i
		}
	}
	return defaultVal
}

func min(a, b int) int {
	if a < b {
		return a
	}
	return b
}
